<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Connect 4 Trainer</title>

<style>
body {
  font-family: system-ui;
  text-align: center;
  background: #111;
  color: #fff;
}

#board {
  display: grid;
  grid-template-columns: repeat(7, 48px);
  gap: 6px;
  justify-content: center;
  margin: 20px auto;
}

.cell {
  width: 48px;
  height: 48px;
  background: #333;
  border-radius: 50%;
}

.p1 { background: red; }
.p2 { background: gold; }

#msg {
  margin-top: 15px;
  min-height: 24px;
}
</style>
</head>

<body>

<h2>4 בשורה – מצב אימון</h2>
<div id="board"></div>
<div id="msg"></div>

<script>
const ROWS = 6, COLS = 7;
let board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));

function render() {
  const b = document.getElementById('board');
  b.innerHTML = '';
  for (let r = 0; r < ROWS; r++) {
    for (let c = 0; c < COLS; c++) {
      const d = document.createElement('div');
      d.className = 'cell ' + (board[r][c] === 1 ? 'p1' : board[r][c] === 2 ? 'p2' : '');
      d.onclick = () => playerMove(c);
      b.appendChild(d);
    }
  }
}

function drop(col, p) {
  for (let r = ROWS - 1; r >= 0; r--) {
    if (board[r][col] === 0) {
      board[r][col] = p;
      return true;
    }
  }
  return false;
}

function win(b, p) {
  const D = [[1,0],[0,1],[1,1],[1,-1]];
  for (let r=0;r<6;r++) for (let c=0;c<7;c++)
    for (let [dr,dc] of D) {
      let k=0;
      for (let i=0;i<4;i++) {
        let rr=r+dr*i, cc=c+dc*i;
        if (rr>=0&&rr<6&&cc>=0&&cc<7&&b[rr][cc]==p) k++;
      }
      if (k==4) return true;
    }
  return false;
}

function validMoves(b) {
  return [...Array(7).keys()].filter(c => b[0][c] === 0);
}

function clone(b) {
  return b.map(r => r.slice());
}

function minimax(b, d, max) {
  if (win(b,2)) return { s: 100-d };
  if (win(b,1)) return { s: d-100 };
  const m = validMoves(b);
  if (!m.length || d >= 5) return { s: 0 };

  let best = m[0];
  let score = max ? -1e9 : 1e9;

  for (let c of m) {
    const nb = clone(b);
    drop(c, max ? 2 : 1);
    const r = minimax(nb, d+1, !max).s;
    if (max && r > score || !max && r < score) {
      score = r;
      best = c;
    }
  }
  return { s: score, c: best };
}

function playerMove(col) {
  if (!drop(col,1)) return;

  const opt = minimax(clone(board),0,true);
  const msg = document.getElementById('msg');

  if (opt.c !== col) msg.textContent = '❌ מהלך לא אופטימלי';
  else msg.textContent = '✅ מהלך נכון';

  drop(opt.c,2);
  render();
}

render();
</script>

</body>
</html>
